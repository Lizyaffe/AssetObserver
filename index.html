<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Asset Spy</title>
    <style type="text/css">
        table {border-collapse: collapse;}
        td {padding: 10px;}
        .result {white-space: pre; font-family: monospace;}
    </style>
    <script type="text/javascript">
        function submitForm(form) {
            var url = '/api';
            var params = '';
            for (i = 0; i < form.elements.length; i++) {
                if (! form.elements[i].name) {
                    continue;
                }
                if (i > 0) {
                    params += '&';
                }
                params += encodeURIComponent(form.elements[i].name);
                params += '=';
                params += encodeURIComponent(form.elements[i].value);
            }
            var request = new XMLHttpRequest();
            request.open("POST", url, false);
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            request.send(params);
            var result = JSON.stringify(JSON.parse(request.responseText), null, 4);
            form.getElementsByClassName("result")[0].textContent = result;
            return false;
        }
        function getAccountBalances(form) {
            var accounts = form.elements["accounts"].value.split('\n');
            var balance = 0;
            var result = '<table><tr><th>account</th><th>balance</th></tr>';
            for (i = 0; i < accounts.length; i++) {
                account = accounts[i].trim();
                if (account != '') {
                    var accountBalance = getBalance(accounts[i]);
                    result += '<tr><td>';
                    result += account;
                    result += ':</td><td>';
                    result += formatAmount(accountBalance);
                    result += '</td></tr>';
                    balance += accountBalance;
                }
            }
            result += '<tr><td>total:</td><td>';
            result += formatAmount(balance);
            result += '</td></tr></table>';
            form.getElementsByClassName("result")[0].innerHTML = result;
            return false;
        }
        function getBalance(account) {
            var request = new XMLHttpRequest();
            request.open("GET", '/nxt?requestType=getBalance&account=' + account, false);
            request.send();
            return parseInt(JSON.parse(request.responseText).balanceNQT);
        }
        function formatAmount(amount) {
            var digits=[], formattedAmount = "", i;
            var wholePart = Math.floor(amount / 100000000);
            var fractionalPart = amount % 100000000;
            do {
                digits[digits.length] = wholePart % 10;
                wholePart = Math.floor(wholePart / 10);
            } while (wholePart > 0);
            for (i = 0; i < digits.length; i++) {
                if (i > 0 && i % 3 == 0) {
                    formattedAmount = "'" + formattedAmount;
                }
                formattedAmount = digits[i] + formattedAmount;
            }
            if (fractionalPart != 0) {
                formattedAmount += ".";
                for (i = fractionalPart.length; i < 8; i++) {
                    formattedAmount += "0";
                }
                formattedAmount += fractionalPart;
            }
            return formattedAmount;
        }
    </script>
</head>
<body>
<h3>Extended Asset APIs</h3>
<b>Get Status:</b><br/>
<form action="/api" method="POST" onsubmit="return submitForm(this);">
    <input type="hidden" name="requestType" value="getStatus"/>
    <table>
        <tr>
            <td colspan="2"><input type="submit" value="submit"/></td>
        </tr>
    </table>
    <div class="result"></div>
</form>
<hr>
<b>Get All Assets:</b><br/>
<form action="/api" method="POST" onsubmit="return submitForm(this);">
    <input type="hidden" name="requestType" value="getAllAssets"/>
    <table>
        <tr>
            <td colspan="2"><input type="submit" value="submit"/></td>
        </tr>
    </table>
    <div class="result"></div>
</form>
<hr>
<b>Get Account Balance:</b><br/>
<form action="/api" method="POST" onsubmit="return submitForm(this);">
    <input type="hidden" name="requestType" value="getAccountBalance"/>
    <table>
        <tr>
            <td>Account Id (numeric or NXT):</td>
            <td><input type="text" name="accountId"/></td>
        </tr>
        <tr>
            <td colspan="2"><input type="submit" value="submit"/></td>
        </tr>
    </table>
    <div class="result"></div>
</form>
<hr>
<b>Get Asset Distribution:</b><br/>
<form action="/api" method="POST" onsubmit="return submitForm(this);">
    <input type="hidden" name="requestType" value="getAssetDistribution"/>
    <table>
        <tr>
            <td>Asset Id:</td>
            <td><input type="text" name="assetId"/></td>
        </tr>
        <tr>
            <td>Ignore Issuer Account [true/false[false]]:</td>
            <td><input type="text" name="ignoreIssuerAccount"/></td>
        </tr>
        <tr>
            <td>Date [YYYYMMDD]:</td>
            <td><input type="text" name="balanceDate"/></td>
        </tr>
        <tr>
            <td colspan="2"><input type="submit" value="submit"/></td>
        </tr>
    </table>
    <div class="result"></div>
</form>
<b>Get Asset Movements:</b><br/>
<form action="/api" method="POST" onsubmit="return submitForm(this);">
    <input type="hidden" name="requestType" value="getAssetMovements"/>
    <table>
        <tr>
            <td>Asset Id:</td>
            <td><input type="text" name="assetId"/></td>
        </tr>
        <tr>
            <td>Type [transfer / trade]:</td>
            <td><input type="text" name="type"/></td>
        </tr>
        <tr>
            <td colspan="2"><input type="submit" value="submit"/></td>
        </tr>
    </table>
    <div class="result"></div>
</form>
<hr>

</body>
</html>